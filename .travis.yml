sudo: false

language: python

python:
  - 3.6
  - 3.4

jobs:
  include:
    - stage: Tests          # Test stage
      name: "Unit Tests"    #  - First test stage job:  Unit test with coverage report
      script:
        - pytest --cov

    - script:               #  - Second test stage job: Import module without coverage report
      - python tests/import.py
      name: "Import module"
      after_success: skip

    - stage: Deploy         # Deploy stage (only for tagged versions)
      if: tag IS present
      install: skip
      after_success: skip
      script:
          - echo "Building docker container..."

    - stage: "Test deploy"  # Test the deployed container
      if: tag IS present
      install:
        - echo "Installing..."
      script:
        - echo "Testing docker container..."
      after_success:
        - echo "Docker container test OK"

install:
    - pip install .
    - pip install coverage codecov codacy-coverage pytest pytest-cov

after_success:
    - codecov
    - coverage report -m
    - export CODACY_PROJECT_TOKEN=f5e3e796439b4c5c9df4c5848b69cfd9
    - coverage xml
    - python-codacy-coverage -r coverage.xml
