sudo: false

language: python

python:
  - 3.6

jobs:
  include:
    - stage: unit-tests
    - stage: deploy
      if: tag IS present
      install: skip
      script: ./deploy.sh
      after_success: skip
      # deploy:
      #   provider: script
      #   script: deploy.sh
        # on:
        #   branch: master
        #   tags: true

install:
  - pip install .
  - pip install coverage codecov codacy-coverage pytest pytest-cov

script:
  - pytest --cov

after_success:
  - codecov
  - coverage report -m
  - export CODACY_PROJECT_TOKEN=f5e3e796439b4c5c9df4c5848b69cfd9
  - coverage xml
  - python-codacy-coverage -r coverage.xml
